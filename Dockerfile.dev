# --- Build Stage (using your name 'builder' or similar) ---
FROM node:latest as builder # Start from a node image

WORKDIR /angular-app # <-- Set the working directory here

# Copy package.json and package-lock.json (or yarn.lock)
# The './' here is RELATIVE TO THE WORKDIR (/angular-app)
# The first '.' is RELATIVE TO THE BUILD CONTEXT (root of your git repo)
COPY package.json package-lock.json ./

# Install dependencies - runs INSIDE /angular-app
RUN npm install

# Copy the rest of your application code - copies into /angular-app
COPY . .

# Run tests - runs INSIDE /angular-app
RUN npm test -- --no-watch --reporters=default --code-coverage

# Build the app - runs INSIDE /angular-app
RUN ng build --configuration production

# --- Serve Stage ---
# (This part uses a different base image and doesn't need /angular-app)
FROM nginx:alpine as runner
# ... copy build artifacts from builder stage ...
