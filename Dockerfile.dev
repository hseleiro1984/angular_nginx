# --- Build Stage ---
FROM node:latest as builder

# Set the working directory FIRST
WORKDIR /angular-app # <-- This should be early in the file

# Now, COPY using paths relative to the build context (repo root)
# The destination './' is relative to the WORKDIR (/angular-app)
COPY angular-app/package*.json ./ # Copies to /angular-app/package*.json

# Install dependencies - runs INSIDE /angular-app
RUN npm install

# Copy the rest of your application code from the 'angular-app' subdir into the WORKDIR
COPY angular-app/. .

# Run tests - runs INSIDE /angular-app
RUN npm test -- --no-watch --reporters=default --code-coverage

# Build the app - runs INSIDE /angular-app
RUN ng build --configuration production

# --- Serve Stage ---
FROM nginx:alpine as runner

# Copy the built application from the builder stage
# Assuming your build output goes to /angular-app/dist/your-app-name in the builder
COPY --from=builder /angular-app/dist/your-app-name /usr/share/nginx/html

# ... rest of your Nginx setup ...
